LOAD 'pg_diffix';
----------------------------------------------------------------
-- Admin functions
----------------------------------------------------------------
-- Multiple calls should give consistent results.
SELECT diffix.hash_record(test_customers) FROM test_customers;
                        hash_record                         
------------------------------------------------------------
 \xf9fbf989a0811cd4994780ceb97b2b65e4f748970e4a87e0ad57114e
(1 row)

SELECT diffix.hash_record(test_customers), diffix.hash_record(test_customers) FROM test_customers;
                        hash_record                         |                        hash_record                         
------------------------------------------------------------+------------------------------------------------------------
 \xf9fbf989a0811cd4994780ceb97b2b65e4f748970e4a87e0ad57114e | \xf9fbf989a0811cd4994780ceb97b2b65e4f748970e4a87e0ad57114e
(1 row)

SELECT encode(diffix.hash_record(test_customers), 'hex') FROM test_customers;
                          encode                          
----------------------------------------------------------
 f9fbf989a0811cd4994780ceb97b2b65e4f748970e4a87e0ad57114e
(1 row)

-- Can hash empty table.
SELECT diffix.hash_record(empty_test_customers) FROM empty_test_customers;
                        hash_record                         
------------------------------------------------------------
 \xe3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b
(1 row)

SELECT encode(diffix.hash_record(empty_test_customers), 'hex') FROM empty_test_customers;
                          encode                          
----------------------------------------------------------
 e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b
(1 row)

-- Check seclabels if they match with above hashes.
SELECT label
FROM pg_catalog.pg_seclabel
WHERE provider = 'pg_diffix'
      AND objsubid = 0
      AND objoid IN ('test_customers'::regclass::oid, 'empty_test_customers'::regclass::oid);
                               label                               
-------------------------------------------------------------------
 personal:f9fbf989a0811cd4994780ceb97b2b65e4f748970e4a87e0ad57114e
 personal:e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b
(2 rows)

