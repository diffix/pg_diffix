CREATE TABLE test_customers (id INTEGER PRIMARY KEY, city TEXT);
INSERT INTO test_customers VALUES
 (0, NULL), (1, 'Berlin'), (2, 'Berlin'), (3, 'Rome'), (4, 'London'), (5, 'Berlin'), (6, 'Rome'),
 (7, 'Rome'), (8, 'Berlin'), (9, 'Rome'), (10, 'Berlin'), (11, 'Rome'), (12, 'Rome'), (13, 'Rome');
CREATE EXTENSION IF NOT EXISTS pg_diffix;
LOAD 'pg_diffix';
SELECT diffix_reload_config();
 diffix_reload_config 
----------------------
 t
(1 row)

SELECT COUNT(*) FROM test_customers;
 count 
-------
    12
(1 row)

SELECT COUNT(city) FROM test_customers;
 count 
-------
    11
(1 row)

SELECT city, COUNT(DISTINCT id) FROM test_customers GROUP BY 1;
  city  | count 
--------+-------
 Rome   |     5
 Berlin |     4
(2 rows)

-- Gets rejected because `city` is not the AID.
SELECT COUNT(DISTINCT city) FROM test_customers;
ERROR:  [PG_DIFFIX] COUNT(DISTINCT col) requires an AID column as its argument.
SELECT city FROM test_customers;
  city  
--------
 Rome
 Rome
 Rome
 Rome
 Rome
 Rome
 Berlin
 Berlin
 Berlin
 Berlin
(10 rows)

SELECT city FROM test_customers GROUP BY 1 HAVING length(city) <> 4;
  city  
--------
 Berlin
(1 row)

SELECT COUNT(*) FROM test_customers WHERE city = 'London';
 count 
-------
     0
(1 row)

